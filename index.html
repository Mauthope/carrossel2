<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Produção de OP</title>
    <style>
       /* Estilos permanecem os mesmos */
    </style>
</head>
<body>
    <h1>Controle de Produção</h1>

    <div class="machine-buttons">
        <button id="machine1" class="machine-btn inactive" onclick="toggleMachine(1)">CL-01</button>
        <button id="machine2" class="machine-btn inactive" onclick="toggleMachine(2)">CL-02</button>
        <button id="machine3" class="machine-btn inactive" onclick="toggleMachine(3)">CL-03</button>
        <button id="machine4" class="machine-btn inactive" onclick="toggleMachine(4)">CL-04</button>
    </div>

    <form id="productionForm">
        <!-- Inputs para número da OP, código do componente, quantidade, etc. -->
    </form>

    <h2>Resultados:</h2>

    <div class="results-container">
        <!-- Resultados como Número de Cortes, Voltas, etc. -->
    </div>

    <table id="recordsTable">
        <thead>
            <tr>
                <th>Data e Hora</th>
                <th>Máquinas Ativas</th>
                <th>Número da OP</th>
                <th>Código do Componente</th>
                <th>Quantidade da OP</th>
                <th>Comprimento da OP</th>
                <th>Tipo de Tecido</th>
                <th>Gramatura da OP</th>
                <th>Quantidade de Peças Retiradas</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <button onclick="downloadCSV()">Download CSV</button>

    <script>
        let records = [];

        function toggleMachine(machineNumber) {
            const button = document.getElementById(`machine${machineNumber}`);
            button.classList.toggle('active');
            button.classList.toggle('inactive');
        }

        function calculateAndSave() {
            const opQuantity = parseFloat(document.getElementById('opQuantity').value);
            const opLength = parseFloat(document.getElementById('opLength').value);
            const opWeight = parseFloat(document.getElementById('opWeight').value);
            const fabricType = document.getElementById('fabricType').value;

            if (isNaN(opQuantity) || isNaN(opLength) || isNaN(opWeight) || !fabricType) {
                alert('Por favor, preencha todos os campos corretamente.');
                return;
            }

            const maxCarouselLength = 540;
            const numCuts = Math.floor(maxCarouselLength / opLength);
            document.getElementById('cutsResult').textContent = `Número de Cortes: ${numCuts}`;

            let numTurns = 0;

            // Lógica para o cálculo do número de voltas conforme o tipo de tecido
            if (fabricType === 'Plano') {
                numTurns = Math.floor(((120 - opWeight) * 0.73) + 40);
            } else if (fabricType === 'Tubular') {
                numTurns = Math.floor(((82 - opWeight) * 0.3) + 40);
            } else if (fabricType === 'PATCH') {
                numTurns = 25; // Valor fixo
            }

            // Regra nova: Verificar se número de voltas vezes número de cortes é maior que a quantidade da OP
            const calculatedAmount = numTurns * numCuts;

            if (calculatedAmount > opQuantity) {
                // Ajustar o número de voltas se o cálculo exceder a quantidade da OP
                numTurns = Math.floor(opQuantity / numCuts);
            }

            document.getElementById('turnsResult').textContent = `Número de Voltas: ${numTurns}`;

            // Continuando os cálculos conforme o código original
            const cutAmount = Math.floor(numCuts * numTurns);
            document.getElementById('cutAmountResult').textContent = `Quantidade Cortada: ${cutAmount}`;

            const numCycles = cutAmount > 0 ? opQuantity / cutAmount : 0;
            document.getElementById('cyclesResult').textContent = `Número de Ciclos: ${numCycles}`;

            const fractionalPart = numCycles - Math.floor(numCycles);
            const remainingTurns = Math.ceil(numTurns * fractionalPart);
            document.getElementById('remainingTurnsResult').textContent = `Restante de Voltas para Fechar a OP: ${remainingTurns}`;

            const totalCutAmount = Math.floor((numCuts * Math.floor(numCycles) * numTurns) + remainingTurns * numCuts);
            document.getElementById('totalCutAmountResult').textContent = `Quantidade Total Cortada: ${totalCutAmount}`;
        }
    </script>
</body>
</html>
