<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Registro de Produção</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Sistema de Registro de Produção</h1>
    <form id="productionForm">
        <label for="opNumber">Número da OP:</label>
        <input type="text" id="opNumber" required><br><br>

        <label for="componentCode">Código do Componente:</label>
        <input type="text" id="componentCode" required><br><br>

        <label for="opQuantity">Quantidade da OP:</label>
        <input type="number" id="opQuantity" required><br><br>

        <label for="opLength">Comprimento da OP (em metros):</label>
        <input type="number" id="opLength" required><br><br>

        <label for="fabricType">Tipo de Tecido:</label>
        <select id="fabricType" required>
            <option value="Plano">Plano</option>
            <option value="Tubular">Tubular</option>
            <option value="PET">PET</option>
        </select><br><br>

        <label for="opWeight">Gramatura da OP (em g/m²):</label>
        <input type="number" id="opWeight" required><br><br>

        <label for="piecesRemoved">Quantidade de Peças Retiradas:</label>
        <input type="number" id="piecesRemoved" required><br><br>

        <button type="submit">Registrar Produção</button>
    </form>

    <h2 id="totalCutAmount">Quantidade Total Cortada: 0</h2>
    <button onclick="downloadCSV()">Baixar Registros</button>

    <table id="recordsTable">
        <thead>
            <tr>
                <th>Data e Hora</th>
                <th>Máquinas Ativas</th>
                <th>Número da OP</th>
                <th>Código do Componente</th>
                <th>Quantidade da OP</th>
                <th>Comprimento da OP</th>
                <th>Tipo de Tecido</th>
                <th>Gramatura da OP</th>
                <th>Quantidade de Peças Retiradas</th>
                <th>Número de Cortes</th>
            </tr>
        </thead>
        <tbody>
            <!-- Registros serão adicionados aqui -->
        </tbody>
    </table>

    <script>
        let records = [];
        let totalCutAmount = 0;

        document.getElementById('productionForm').addEventListener('submit', function(event) {
            event.preventDefault();
            registerProduction();
        });

        function registerProduction() {
            const opNumber = document.getElementById('opNumber').value;
            const componentCode = document.getElementById('componentCode').value;
            const opQuantity = parseInt(document.getElementById('opQuantity').value);
            const opLength = parseFloat(document.getElementById('opLength').value);
            const fabricType = document.getElementById('fabricType').value;
            const opWeight = parseFloat(document.getElementById('opWeight').value);
            const piecesRemoved = parseInt(document.getElementById('piecesRemoved').value);
            
            // Cálculo do número de cortes
            const cuts = Math.floor(opLength / (opWeight / 100)); // Exemplo de cálculo simplificado
            totalCutAmount += cuts;
            document.getElementById('totalCutAmount').textContent = `Quantidade Total Cortada: ${totalCutAmount}`;

            // Registro dos dados
            const dateTime = new Date().toLocaleString();
            const activeMachines = getActiveMachinesCount();
            records.push({ dateTime, activeMachines, opNumber, componentCode, opQuantity, opLength, fabricType, opWeight, piecesRemoved, cuts });
            updateRecordsTable();
        }

        function getActiveMachinesCount() {
            // Função para obter o número de máquinas ativas
            return Math.floor(Math.random() * 10) + 1; // Simulando 1 a 10 máquinas ativas
        }

        function updateRecordsTable() {
            const tbody = document.getElementById('recordsTable').querySelector('tbody');
            tbody.innerHTML = '';
            records.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.dateTime}</td>
                    <td>${record.activeMachines}</td>
                    <td>${record.opNumber}</td>
                    <td>${record.componentCode}</td>
                    <td>${record.opQuantity}</td>
                    <td>${record.opLength}</td>
                    <td>${record.fabricType}</td>
                    <td>${record.opWeight}</td>
                    <td>${record.piecesRemoved}</td>
                    <td>${record.cuts}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function downloadCSV() {
            let csv = 'Data e Hora, Máquinas Ativas, Número da OP, Código do Componente, Quantidade da OP, Comprimento da OP, Tipo de Tecido, Gramatura da OP, Quantidade de Peças Retiradas, Número de Cortes\n';
            records.forEach(record => {
                csv += `${record.dateTime}, ${record.activeMachines}, ${record.opNumber}, ${record.componentCode}, ${record.opQuantity}, ${record.opLength}, ${record.fabricType}, ${record.opWeight}, ${record.piecesRemoved}, ${record.cuts}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.setAttribute('download', 'registros_producao.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
