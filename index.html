<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Produção de OP</title>
    <style>
      body {
        font-family: 'Roboto', sans-serif;
        margin: 20px;
        background-color: #f4f6f9;
        color: #333;
      }

      h1 {
        color: #3f51b5;
        text-align: center;
        font-size: 2.5em;
        font-weight: bold;
        margin-bottom: 20px;
      }

      .input-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #666;
      }

      input[type="number"],
      input[type="text"],
      select {
        width: 100%;
        padding: 12px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        box-sizing: border-box;
        transition: border-color 0.3s;
      }

      input[type="number"]:focus,
      input[type="text"]:focus,
      select:focus {
        border-color: #3f51b5;
      }

      button {
        padding: 12px 25px;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin-right: 8px;
        margin-top: 12px;
        transition: background-color 0.3s;
        font-size: 1em;
      }

      .machine-btn {
        width: 160px;
        height: 50px;
        margin-bottom: 10px;
        font-size: 16px;
        border-radius: 6px;
      }

      .machine-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 25px;
      }

      .active {
        background-color: #f44336;
      }

      .inactive {
        background-color: #4caf50;
      }

      .calc-btn {
        background-color: #3f51b5;
      }

      .calc-btn:hover {
        background-color: #3949ab;
      }

      .result-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        margin-top: 25px;
      }

      .result {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 20px;
        margin: 10px;
        flex: 1 1 calc(30% - 20px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.3s ease;
      }

      .result:hover {
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }

      table {
        margin-top: 25px;
        width: 100%;
        border-collapse: collapse;
        font-size: 1em;
      }

      table, th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
      }

      th {
        background-color: #3f51b5;
        color: white;
        text-transform: uppercase;
      }

      h2 {
        margin-top: 40px;
        text-align: center;
        font-size: 2em;
        font-weight: bold;
      }

      #downloadBtn {
        padding: 12px 25px;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin-right: 8px;
        margin-top: 12px;
        transition: background-color 0.3s;
        font-size: 1em;
      }

      #downloadBtn:hover {
        background-color: #0056b3;
      }

      .results-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      .result-block {
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 1.3em;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .result-block:hover {
        background-color: #f0f0f0;
      }

      .color1 { background-color: #e1f5fe; }
      .color2 { background-color: #ffecb3; }
      .color3 { background-color: #ede7f6; }
      .color4 { background-color: #c8e6c9; }
      .color5 { background-color: #ffccbc; }
      .color6 { background-color: #ffebee; }
    </style>
</head>
<body>
    <h1>Controle de Produção</h1>

    <div class="machine-buttons">
        <button id="machine1" class="machine-btn inactive" onclick="toggleMachine(1)">CL-01</button>
        <button id="machine2" class="machine-btn inactive" onclick="toggleMachine(2)">CL-02</button>
        <button id="machine3" class="machine-btn inactive" onclick="toggleMachine(3)">CL-03</button>
        <button id="machine4" class="machine-btn inactive" onclick="toggleMachine(4)">CL-04</button>
    </div>

    <form id="productionForm">
        <div class="input-group">
            <label for="opNumber">Número da OP:</label>
            <input type="text" id="opNumber" maxlength="13" oninput="formatOPNumber(this)" required>
        </div>
        <div class="input-group">
            <label for="componentCode">Código do Componente:</label>
            <input type="text" id="componentCode" required>
        </div>
        <div class="input-group">
            <label for="opQuantity">Quantidade da OP:</label>
            <input type="number" id="opQuantity" min="0" required>
        </div>
        <div class="input-group">
            <label for="opLength">Comprimento da OP (cm):</label>
            <input type="number" id="opLength" min="0" required>
        </div>
        <div class="input-group">
            <label for="fabricType">Tipo de Tecido:</label>
            <select id="fabricType" required>
                <option value="">Selecione</option>
                <option value="Plano">Plano</option>
                <option value="Tubular">Tubular</option>
                <option value="PATCH">PATCH</option>
                <option value="Saia">Saia</option>
            </select>
        </div>
        <div class="input-group">
            <label for="opWeight">Gramatura da OP:</label>
            <input type="number" id="opWeight" min="0" required>
        </div>
        <button type="button" class="calc-btn" onclick="calculateAndSave()">Calcular e Salvar</button>
    </form>

    <h2>Resultados:</h2>

    <div class="results-container">
        <div class="result-block color2" onclick="showPopup('Tamanho ao qual deve-se ajustar o carrossel para não sobrar muito material após cortado, este ajuste é feito no carrossel trocando os pinos de lugar. Recurso importante para não gerar resíduo.')">
            <p id="carouselSizeResult">Tamanho do carrossel: </p>
        </div>
        <div class="result-block color1" onclick="showPopup('É o número de vezes ao qual você irá cortar o tecido na mesa.')">
            <p id="cutsResult">Número de Cortes na mesa: </p>
        </div>
        <div class="result-block color2" onclick="showPopup('É o número de voltas que o carrossel irá fazer, pode ser definido no painel da máquina.')">
            <p id="turnsResult">Número de Voltas Carrossel: </p>
        </div>
        <div class="result-block color5" onclick="showPopup('É o número de vezes ao qual você irá retirar o tecido do carrossel e colocá-lo na mesa.')">
            <p id="cyclesResult">Número de Carrossel: </p>
        </div>
        <div class="result-block color6" onclick="showPopup('É o número de voltas restantes para fechar a quantidade da OP, por exemplo: se o número de carrossel é 5,45, serão 5 carrosséis e mais 0,45 que, convertendo em voltas, fecharão o total da OP.')">
            <p id="remainingTurnsResult">Restante de Voltas para Fechar a OP: </p>
        </div>
        <div class="result-block color3" onclick="showPopup('É o número de ciclos que faltam para atingir a OP.')">
            <p id="remainingCyclesResult">Ciclos Restantes: </p>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>OP</th>
                <th>Código Componente</th>
                <th>Quantidade</th>
                <th>Comprimento (cm)</th>
                <th>Gramatura</th>
                <th>Tipo de Tecido</th>
                <th>Tamanho Carrossel</th>
                <th>Número Cortes</th>
                <th>Número Voltas</th>
                <th>Número Carrossel</th>
                <th>Voltas Restantes</th>
                <th>Ciclos Restantes</th>
            </tr>
        </thead>
        <tbody id="resultsTable">
        </tbody>
    </table>

    <button id="downloadBtn" onclick="downloadCSV()">Download CSV</button>

    <script>
      let activeMachine = null;

      function toggleMachine(machineNumber) {
        if (activeMachine === machineNumber) {
          document.getElementById('machine' + machineNumber).classList.toggle('active');
          activeMachine = null;
        } else {
          if (activeMachine) {
            document.getElementById('machine' + activeMachine).classList.remove('active');
          }
          document.getElementById('machine' + machineNumber).classList.add('active');
          activeMachine = machineNumber;
        }
      }

      function formatOPNumber(input) {
        let value = input.value.replace(/\D/g, '');
        if (value.length > 7) {
          input.value = value.slice(0, 7) + '.' + value.slice(7);
        } else {
          input.value = value;
        }
      }

      function showPopup(message) {
        alert(message);
      }

      function calculateAndSave() {
        let opNumber = document.getElementById('opNumber').value;
        let componentCode = document.getElementById('componentCode').value;
        let opQuantity = parseFloat(document.getElementById('opQuantity').value);
        let opLength = parseFloat(document.getElementById('opLength').value);
        let fabricType = document.getElementById('fabricType').value;
        let opWeight = parseFloat(document.getElementById('opWeight').value);

        if (!opNumber || !componentCode || !opQuantity || !opLength || !fabricType || !opWeight) {
          alert("Por favor, preencha todos os campos.");
          return;
        }

        let carouselSize = opLength;
        let numberOfCuts = Math.ceil(opQuantity / 5);
        let numberOfTurns = Math.ceil(opQuantity / 10);
        let numberOfCycles = Math.ceil(opQuantity / 20);
        let remainingTurns = opQuantity % 10;
        let remainingCycles = opQuantity % 20;

        document.getElementById('carouselSizeResult').innerText = `Tamanho do carrossel: ${carouselSize} cm`;
        document.getElementById('cutsResult').innerText = `Número de Cortes na mesa: ${numberOfCuts}`;
        document.getElementById('turnsResult').innerText = `Número de Voltas Carrossel: ${numberOfTurns}`;
        document.getElementById('cyclesResult').innerText = `Número de Carrossel: ${numberOfCycles}`;
        document.getElementById('remainingTurnsResult').innerText = `Restante de Voltas para Fechar a OP: ${remainingTurns}`;
        document.getElementById('remainingCyclesResult').innerText = `Ciclos Restantes: ${remainingCycles}`;

        let table = document.getElementById('resultsTable');
        let row = table.insertRow();
        row.insertCell(0).innerText = opNumber;
        row.insertCell(1).innerText = componentCode;
        row.insertCell(2).innerText = opQuantity;
        row.insertCell(3).innerText = opLength;
        row.insertCell(4).innerText = opWeight;
        row.insertCell(5).innerText = fabricType;
        row.insertCell(6).innerText = carouselSize;
        row.insertCell(7).innerText = numberOfCuts;
        row.insertCell(8).innerText = numberOfTurns;
        row.insertCell(9).innerText = numberOfCycles;
        row.insertCell(10).innerText = remainingTurns;
        row.insertCell(11).innerText = remainingCycles;
      }

      function downloadCSV() {
        let table = document.getElementById('resultsTable');
        let csv = [];
        for (let i = 0; i < table.rows.length; i++) {
          let row = table.rows[i];
          let rowData = [];
          for (let j = 0; j < row.cells.length; j++) {
            rowData.push(row.cells[j].innerText);
          }
          csv.push(rowData.join(','));
        }
        let csvString = csv.join('\n');
        let blob = new Blob([csvString], { type: 'text/csv' });
        let downloadLink = document.createElement('a');
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = 'resultados.csv';
        downloadLink.click();
      }
    </script>
</body>
</html>
